<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAMPUS CAPITAL | Strathmore Student-Run Fund</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- Deep, Intuitive Mobile-First CSS Best Practices (2025) --- */
        @media (max-width: 700px) {
            html, body {
                padding-bottom: env(safe-area-inset-bottom, 70px);
                background: var(--bg);
            }
            body {
                font-size: clamp(15px, 4vw, 18px);
                line-height: 1.7;
                -webkit-tap-highlight-color: transparent;
            }
            .main-grid {
                flex-direction: column !important;
                min-width: 100vw;
                max-width: 100vw;
                width: 100vw;
                padding: 0 0 env(safe-area-inset-bottom, 70px) 0;
                background: var(--bg);
            }
            .side {
                min-width: 100vw !important;
                max-width: 100vw !important;
                bottom: 10px !important;
                max-width: 99vw !important;
                min-width: unset !important;
                font-size: 1em !important;
                border-radius: 14px !important;
                box-shadow: 0 4px 16px rgba(10,25,47,0.13) !important;
            }
            .ai-chatbox input, .ai-chatbox button {
                min-height: 48px !important;
                font-size: 1em !important;
                border-radius: 10px !important;
            }
            .ai-chatbox button {
                min-width: 48px !important;
                font-size: 1em !important;
            }
            nav a {
                min-width: 44px;
                min-height: 44px;
                font-size: 1em !important;
                border-radius: 8px !important;
                padding: 8px 12px !important;
            }
            input, select, textarea, button {
                min-height: 48px !important;
                font-size: 1em !important;
                border-radius: 10px !important;
            }
            #ai-demos form, #ai-demos #finance-results {
                border-radius: 14px !important;
                box-shadow: 0 2px 8px rgba(10,25,47,0.10) !important;
                padding: 12px 2vw 10px 2vw !important;
            }
            #ai-demos form label {
                font-size: 1em !important;
                margin-bottom: 6px !important;
            }
            #ai-demos form input[type="number"],
            #ai-demos form input[type="text"] {
                font-size: 1em !important;
                border-radius: 10px !important;
                min-height: 48px !important;
            }
            #ai-demos form button[type="submit"] {
                font-size: 1em !important;
                border-radius: 10px !important;
                min-height: 48px !important;
                min-width: 48px !important;
            }
            table, th, td {
                font-size: 1em !important;
                border-radius: 8px !important;
                background: rgba(33,38,45,0.97) !important;
            }
            .muted {
                font-size: 1em !important;
            }
            .tag {
                font-size: 0.95em !important;
                border-radius: 8px !important;
                padding: 3px 12px !important;
            }
            img, video, iframe {
                border-radius: 12px !important;
                box-shadow: 0 2px 8px rgba(10,25,47,0.10) !important;
                max-width: 96vw !important;
                margin: 0 auto 10px auto !important;
            }
            /* Visual separation for sections */
            section.card:not(:last-child) {
                margin-bottom: 28px !important;
            }
            /* Prevent accidental horizontal scroll */
            html, body {
                overflow-x: hidden !important;
            }
        }
        /* --- Sidebars stay visually on the side on mobile --- */
        @media (max-width: 1100px) {
            .main-grid {
                display: flex !important;
                flex-direction: row !important;
                gap: 0 !important;
                width: 100vw !important;
                max-width: 100vw !important;
                overflow-x: auto !important;
                overflow-y: hidden !important;
                min-height: 100vh;
                position: relative;
            }
            .side {
                display: flex !important;
                flex-direction: column !important;
                min-width: 220px !important;
                max-width: 260px !important;
                width: 32vw !important;
                background: linear-gradient(90deg, var(--bg) 90%, transparent);
                box-shadow: 2px 0 12px rgba(10,25,47,0.10);
                z-index: 2;
                position: sticky;
                top: 0;
                height: 100vh;
                overflow-y: auto;
                scrollbar-width: thin;
            }
            .side:last-of-type {
                background: linear-gradient(-90deg, var(--bg) 90%, transparent);
                box-shadow: -2px 0 12px rgba(10,25,47,0.10);
            }
            .center {
                min-width: 320px !important;
                max-width: 100vw !important;
                flex: 1 1 0%;
                margin-top: 0 !important;
                padding: 0 2vw;
                overflow-y: auto;
                z-index: 1;
            }
            body, html {
                overflow-x: hidden !important;
            }
        }
        @media (max-width: 700px) {
            .main-grid {
                min-width: 100vw !important;
                max-width: 100vw !important;
                width: 100vw !important;
                height: 100vh !important;
                overflow-x: auto !important;
                overflow-y: hidden !important;
                flex-wrap: nowrap !important;
            }
            .side {
                min-width: 180px !important;
                max-width: 220px !important;
                width: 38vw !important;
                height: 100vh !important;
                position: sticky;
                top: 0;
                overflow-y: auto;
                box-shadow: 2px 0 12px rgba(10,25,47,0.10);
            }
            .side:last-of-type {
                box-shadow: -2px 0 12px rgba(10,25,47,0.10);
            }
            .center {
                min-width: 260px !important;
                max-width: 100vw !important;
                flex: 1 1 0%;
                padding: 0 2vw;
                overflow-y: auto;
            }
        }
        /* --- Header Mobile Decongestion --- */
        @media (max-width: 700px) {
            header {
                backdrop-filter: blur(8px);
                box-shadow: 0 2px 12px rgba(10,25,47,0.13);
            }
            .header-inner {
                flex-direction: row;
                align-items: center;
                justify-content: flex-start;
                gap: 0;
                padding: 8px 2vw 8px 2vw !important;
                min-height: 54px;
            }
            .logo {
                font-size: 1.1rem !important;
                margin-right: 10px;
                min-width: 120px;
                max-width: 40vw;
                overflow: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
                padding: 0 2px;
            }
            nav {
                flex: 1 1 auto;
                min-width: 0;
                overflow-x: auto;
                display: flex;
                gap: 10px;
                padding: 0 0 0 2vw;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            nav::-webkit-scrollbar { display: none; }
            nav a {
                font-size: 0.97em;
                padding: 6px 10px;
                border-radius: 6px;
                background: rgba(33,38,45,0.7);
                color: var(--text);
                white-space: nowrap;
                transition: background 0.2s, color 0.2s;
            }
            nav a:hover {
                background: var(--accent);
                color: var(--primary);
            }
        }
        /* --- UNIVERSAL PROPORTIONAL SCALING & MOBILE-FIRST CSS (from goals_page.html) --- */
        :root {
            --primary: #0d1117;
            --accent: #58a6ff;
            --bg: #161b22;
            --card-bg: #21262d;
            --glass: rgba(33,38,45,0.92);
            --text: #c9d1d9;
            --muted: #8b949e;
            --border: #30363d;
            --shadow: 0 8px 32px 0 rgba(20,30,50,0.18);
        }
        html { box-sizing: border-box; font-size: clamp(13px, 2.5vw, 18px); }
        *, *:before, *:after { box-sizing: inherit; }
        body {
            font-family: 'Inter', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            width: 100vw;
            max-width: 100vw;
        }
        img, video, iframe {
            max-width: 100%;
            height: auto;
            display: block;
        }
        table {
            width: 100%;
            display: block;
            overflow-x: auto;
            font-size: inherit;
        }
        th, td {
            font-size: inherit;
            padding: 0.5em;
        }
        form, input, select, textarea, button {
            min-width: 0;
            width: 100%;
            max-width: 100%;
            font-size: inherit;
            box-sizing: border-box;
        }
        button, input[type="submit"], .ai-chatbox button {
            padding: 0.6em 1.2em;
            border-radius: 0.5em;
            min-height: 44px;
            min-width: 44px;
        }
        .main-grid {
            display: flex;
            flex-direction: row;
            gap: 32px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 0 32px 0;
            width: 100%;
        }
        .side {
            position: sticky;
            top: 80px;
            align-self: flex-start;
            min-height: 80vh;
            width: 100%;
            max-width: 100vw;
        }
        .center {
            margin-top: 48px;
            width: 100%;
            max-width: 100vw;
        }
        .card, .glass {
            background: var(--glass);
            border-radius: 14px;
            box-shadow: var(--shadow);
            padding: 28px 32px;
            margin-bottom: 32px;
            width: 100%;
            max-width: 100vw;
        }
        header {
            width: 100vw;
            max-width: 100vw;
            background: var(--primary);
            color: var(--accent);
            padding: 0 0 0 0;
            position: sticky;
            top: 0;
            z-index: 1002;
            box-shadow: 0 2px 12px rgba(10,25,47,0.10);
        }
        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 14px 32px 2px 32px;
            position: relative;
            width: 100%;
            max-width: 100vw;
        }
        .logo {
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: 1px;
            margin-left: 0;
            transition: margin-left 0.3s linear, color 1.2s linear;
            flex-shrink: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        nav {
            margin-left: auto;
            display: flex;
            gap: 28px;
        }
        nav a {
            color: var(--text);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }
        nav a:hover { color: var(--accent); }
        .ticker {
            width: 100vw;
            overflow: hidden;
            white-space: nowrap;
            background: var(--primary);
            color: var(--accent);
            font-weight: 700;
            font-size: 1.1em;
            padding: 8px 0 8px 32px;
            position: sticky;
            top: 56px;
            left: 0;
            z-index: 1001;
        }
        h1, h2, h3 { color: var(--accent); margin-top: 0; }
        .goals-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin: 0;
            padding: 0;
            list-style: none;
        }
        .goal-item {
            background: var(--card-bg);
            border-left: 6px solid var(--accent);
            padding: 22px 24px 18px 24px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(10,25,47,0.10);
            transition: box-shadow 0.2s, transform 0.2s;
            position: relative;
        }
        .goal-item:hover {
            box-shadow: 0 8px 24px rgba(10,25,47,0.18);
            transform: translateY(-2px) scale(1.02);
        }
        .muted { color: var(--muted); font-size: 1em; }
        .tag {
            display: inline-block;
            background: var(--accent);
            color: #161b22;
            font-size: 0.85em;
            font-weight: 600;
            border-radius: 6px;
            padding: 2px 10px;
            margin-right: 8px;
            margin-bottom: 6px;
        }
        .ai-chatbox {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 340px;
            max-width: 90vw;
            background: var(--card-bg);
            border-radius: 14px;
            box-shadow: 0 4px 24px rgba(10,25,47,0.18);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
        }
        .ai-chatbox input, .ai-chatbox button {
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
        }
        .ai-chatbox button {
            background: var(--accent);
            color: var(--primary);
        }
        .ai-chatbox button:hover {
            background: var(--primary);
            color: var(--accent);
        }
        #ai-demos form {
            background: rgba(33,38,45,0.85);
            border-radius: 10px;
            padding: 18px 18px 12px 18px;
            margin-bottom: 18px;
            box-shadow: 0 2px 8px rgba(10,25,47,0.10);
            display: flex;
            flex-wrap: wrap;
            gap: 18px 32px;
            align-items: flex-end;
        }
        #ai-demos form label {
            display: block;
            font-size: 1em;
            color: var(--text);
            margin-bottom: 8px;
            font-weight: 500;
        }
        #ai-demos form input[type="number"],
        #ai-demos form input[type="text"] {
            width: 100%;
            padding: 7px 10px;
            margin-top: 4px;
            margin-bottom: 12px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            font-size: 1em;
            box-sizing: border-box;
            transition: border 0.2s;
        }
        #ai-demos form input:focus {
            border: 1.5px solid var(--accent);
            outline: none;
        }
        #ai-demos form button[type="submit"] {
            background: var(--accent);
            color: var(--primary);
            border: none;
            padding: 12px 32px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.1em;
            margin-top: 8px;
            box-shadow: 0 2px 8px rgba(10,25,47,0.10);
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        #ai-demos form button[type="submit"]:hover {
            background: var(--primary);
            color: var(--accent);
        }
        #ai-demos #finance-results {
            background: rgba(33,38,45,0.7);
            border-radius: 8px;
            padding: 18px 18px 10px 18px;
            margin-top: 18px;
            color: var(--accent);
            font-size: 1.08em;
            box-shadow: 0 2px 8px rgba(10,25,47,0.10);
        }
        .sidebar-card {
            background: rgba(33,38,45,0.55);
            border-radius: 10px;
            padding: 18px 14px;
            margin-bottom: 18px;
            box-shadow: 0 2px 8px rgba(10,25,47,0.10);
            color: #eaf6ff;
            backdrop-filter: blur(6px);
        }
        .sidebar-card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--accent);
            font-size: 1.1rem;
            letter-spacing: 0.5px;
            text-shadow: 0 1px 4px #0d1117;
        }
        .sidebar-card a, .sidebar-card ul, .sidebar-card li, .sidebar-card div {
            color: #eaf6ff !important;
            text-shadow: 0 1px 4px #0d1117;
        }
        .sidebar-card a:hover {
            color: #58a6ff !important;
        }
        /* --- MOBILE-FIRST BREAKPOINTS --- */
        @media (max-width: 1100px) {
            .main-grid, .side, .center, .card, .glass, .sidebar-card, .card.hero {
                width: 100vw !important;
                max-width: 100vw !important;
                min-width: 0 !important;
                box-sizing: border-box;
            }
            .main-grid, .side {
                flex-direction: column !important;
                display: flex !important;
                gap: 0 !important;
                padding: 0 !important;
            }
            .sidebar-card {
                margin-bottom: 12px !important;
            }
            .center {
                order: 1;
            }
            .side {
                order: 0;
            }
            .main-grid {
                display: flex;
                flex-direction: column;
                gap: 0;
                width: 100vw;
                max-width: 100vw;
                padding: 0;
            }
            .side {
                display: flex;
                flex-direction: row;
                overflow-x: auto;
                gap: 12px;
                width: 100vw;
                min-width: 0;
                padding: 0 0 8px 0;
                margin-bottom: 0;
                position: static;
                min-height: unset;
                z-index: 1;
                scrollbar-width: thin;
                -webkit-overflow-scrolling: touch;
            }
            .sidebar-card {
                min-width: 260px;
                max-width: 90vw;
                flex: 0 0 auto;
                margin-bottom: 0;
                font-size: 1em;
                box-sizing: border-box;
            }
            .center {
                margin-top: 12px;
                width: 100vw;
                box-sizing: border-box;
            }
            section.card, .glass, .card.hero {
                width: 100vw;
                max-width: 100vw;
                min-width: 0;
                box-sizing: border-box;
                border-radius: 10px;
                padding-left: 4vw;
                padding-right: 4vw;
            }
            .goals-list {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            .goal-item {
                padding: 14px 10px 12px 10px;
                font-size: 1em;
            }
            .ai-chatbox {
                width: 98vw;
                right: 1vw;
                left: 1vw;
                bottom: 10px;
                max-width: 99vw;
                min-width: unset;
                font-size: 1em;
                border-radius: 10px;
                box-shadow: 0 2px 12px rgba(10,25,47,0.13);
            }
            .sidebar-card h3 {
                font-size: 1em;
            }
            .sidebar-card ul, .sidebar-card li, .sidebar-card div {
                font-size: 1em;
            }
            .logo {
                font-size: 1.25rem !important;
            }
            header {
                padding: 0;
            }
            .header-inner {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
                padding: 8px 2vw 2px 2vw !important;
            }
            a[href="#goals"] {
                padding: 8px 18px !important;
                font-size: 1em !important;
            }
            .muted {
                font-size: 1em;
            }
            img {
                max-width: 90vw;
                height: auto;
            }
        }
        @media (max-width: 700px) {
            html {
                font-size: clamp(12px, 2vw, 16px);
            }
            .main-grid, .side, .center, .card, .glass, .sidebar-card, .card.hero {
                width: 100vw !important;
                max-width: 100vw !important;
                min-width: 0 !important;
                box-sizing: border-box;
            }
            .main-grid, .side {
                flex-direction: column !important;
                display: flex !important;
                gap: 0 !important;
                padding: 0 !important;
            }
            .sidebar-card {
                margin-bottom: 10px !important;
            }
            .center {
                order: 1;
            }
            .side {
                order: 0;
            }
            .main-grid {
                flex-direction: column;
                gap: 0;
                width: 100vw;
                max-width: 100vw;
                padding: 0;
            }
            .side {
                flex-direction: row;
                overflow-x: auto;
                gap: 8px;
                width: 100vw;
                min-width: 0;
                padding: 0 0 4px 0;
                margin-bottom: 0;
                position: static;
                min-height: unset;
                z-index: 1;
                scrollbar-width: thin;
                -webkit-overflow-scrolling: touch;
            }
            .sidebar-card {
                min-width: 220px;
                max-width: 92vw;
                flex: 0 0 auto;
                margin-bottom: 0;
                font-size: 0.97em;
                box-sizing: border-box;
            }
            .center {
                margin-top: 8px;
                width: 100vw;
                box-sizing: border-box;
            }
            section.card, .glass, .card.hero {
                width: 100vw;
                max-width: 100vw;
                min-width: 0;
                box-sizing: border-box;
                border-radius: 8px;
                padding-left: 2vw;
                padding-right: 2vw;
            }
            #hero-desc {
                font-size: 0.97rem !important;
            }
            .logo {
                font-size: 1.05rem !important;
            }
            h1#hero-heading {
                font-size: 1.08rem !important;
            }
        }
        @media (max-width: 430px) {
            html {
                font-size: clamp(11px, 1.7vw, 15px);
            }
            .main-grid, .side, .center, .card, .glass, .sidebar-card, .card.hero {
                width: 100vw !important;
                max-width: 100vw !important;
                min-width: 0 !important;
                box-sizing: border-box;
            }
            .header-inner, .container {
                padding: 4px 1vw !important;
            }
            .card, .glass {
                padding: 8px 2vw !important;
            }
            #hero-desc {
                font-size: 0.95rem !important;
            }
            .logo {
                font-size: 0.95rem !important;
            }
            h1#hero-heading {
                font-size: 0.95rem !important;
            }
        }
        @media (max-width: 375px) {
            html {
                font-size: clamp(10px, 1.2vw, 13px);
            }
            .main-grid, .side, .center, .card, .glass, .sidebar-card, .card.hero {
                width: 100vw !important;
                max-width: 100vw !important;
                min-width: 0 !important;
                box-sizing: border-box;
            }
            .sidebar-card {
                min-width: 180px;
                max-width: 98vw;
                font-size: 0.95em;
            }
            .card, .glass, .card.hero {
                padding-left: 1vw;
                padding-right: 1vw;
            }
        }
        /* --- END UNIVERSAL PROPORTIONAL SCALING --- */
    </style>
</head>
<body>
    <header>
        <div class="header-inner" style="min-height:56px;">
            <span class="logo">CAMPUS CAPITAL</span>
            <nav>
                <a href="#executive" id="executive-link">Executive</a>
                <a href="#goals">Goals</a>
                <a href="#ai-demos">AI Demos</a>
                <a href="#resources">Resources</a>
                <a href="#team">Team</a>
                <a href="#contact">Contact</a>
            </nav>
        </div>
    </header>
    <div class="ticker"><span id="ticker-content"></span></div>
    <div class="main-grid">
        <aside class="side">
           
            <div class="sidebar-card" style="background:var(--card-bg);border-radius:10px;padding:18px 14px;margin-bottom:18px;box-shadow:0 2px 8px rgba(10,25,47,0.10);">
                <h3 style="margin-top:0;margin-bottom:10px;color:var(--accent);font-size:1.1rem;">Market Snapshot</h3>
                <div id="market-snapshot" style="font-size:0.98em;line-height:1.5;"></div>
            </div>
            <div class="sidebar-card" style="background:var(--card-bg);border-radius:10px;padding:18px 14px;margin-bottom:18px;box-shadow:0 2px 8px rgba(10,25,47,0.10);">
                <h3 style="margin-top:0;margin-bottom:10px;color:var(--accent);font-size:1.1rem;">Trending Global News</h3>
                <div id="trending-news" style="font-size:0.98em;line-height:1.5;"></div>
            </div>
            <div class="sidebar-card" style="background:var(--card-bg);border-radius:10px;padding:18px 14px;margin-bottom:18px;box-shadow:0 2px 8px rgba(10,25,47,0.10);">
                <h3 style="margin-top:0;margin-bottom:10px;color:var(--accent);font-size:1.1rem;">Quick Finance Facts</h3>
                <div id="finance-fact" style="font-size:0.98em;"></div>
            </div>
<!-- CSS moved to <style> tag below -->
            <div class="sidebar-card" style="background:var(--card-bg);border-radius:10px;padding:18px 14px;box-shadow:0 2px 8px rgba(10,25,47,0.10);">
                <h3 style="margin-top:0;margin-bottom:10px;color:var(--accent);font-size:1.1rem;">Quick Links</h3>
                <ul style="list-style:none;padding-left:0;margin:0;font-size:0.98em;">
                    <li><a href="https://www.nasdaq.com/market-activity" target="_blank">Market Activity</a></li>
                    <li><a href="https://www.blackrock.com/institutions/en-zz/insights" target="_blank">BlackRock Insights</a></li>
                    <li><a href="https://strathmore.edu/" target="_blank">Strathmore University</a></li>
                    <li><a href="https://www.wsj.com/news/markets" target="_blank">WSJ Markets</a></li>
                </ul>
            </div>
        </aside>
        <main class="center">
            <!-- Hero Section -->
            <section class="card hero" id="hero" style="text-align:center;padding-top:32px;padding-bottom:40px;">
                <h1 id="hero-heading" style="font-size:2.7rem;font-weight:800;letter-spacing:-1px;line-height:1.1;margin-bottom:18px;">Strathmore Student-Run Fund: Shaping the Future of Finance</h1>
                <div id="hero-desc" style="font-size:1.18rem;max-width:700px;margin:0 auto 24px auto;line-height:1.7;text-align:justify;font-family:'Segoe UI', 'Arial', 'Verdana', sans-serif;letter-spacing:0.01em;transition:color 0.3s;"></div>
                <a href="#goals" style="display:inline-block;margin-top:18px;padding:12px 32px;font-size:1.1rem;font-weight:700;background:var(--accent);color:var(--primary);border-radius:8px;text-decoration:none;transition:background 0.2s;">See Our Goals</a>
            </section>
            <!-- Goals Section -->
            <section class="card" id="goals">
                <h2 style="margin-bottom:18px;">Our Core Goals</h2>
                <ul class="goals-list">
                    <li class="goal-item"><span class="tag">Investment</span><strong>Build Real-World Investment Skills</strong><br><span class="muted">Engage students in portfolio management, security analysis, and risk assessment using real market data and tools.</span></li>
                    <li class="goal-item"><span class="tag">Governance</span><strong>Promote Transparent Fund Management</strong><br><span class="muted">Adopt best practices in fund governance, compliance, and reporting, inspired by global leaders like BlackRock.</span></li>
                    <li class="goal-item"><span class="tag">Research</span><strong>Advance Financial Knowledge</strong><br><span class="muted">Encourage research on market trends, financial instruments, and the impact of global events on investment strategies.</span></li>
                    <li class="goal-item"><span class="tag">Community</span><strong>Foster Collaboration & Leadership</strong><br><span class="muted">Develop teamwork, leadership, and communication skills through student-led committees and outreach initiatives.</span></li>
                </ul>
            </section>
            <!-- Resources Section (dynamic, script: renderResource) -->
            <section class="card" id="resources">
                <h2 style="margin-bottom:18px;">Explore Top Finance Resources</h2>
                <div style="padding:0 0 8px 0;">
                    <div style="display:flex;align-items:flex-start;gap:18px 32px;flex-wrap:wrap;">
                        <img src="https://www.investopedia.com/favicon.ico" alt="Investopedia" style="width:38px;height:38px;margin-right:12px;vertical-align:middle;">
                        <div style="flex:1 1 320px;min-width:220px;">
                            <b style="font-size:1.18em;color:var(--accent);">Investopedia</b> — The world’s largest and most trusted online resource for financial education, with 25,000+ articles, tutorials, and a trading simulator. <a href="https://www.investopedia.com/" target="_blank" style="color:var(--accent);font-weight:600;">Learn More</a>
                        </div>
                    </div>
                    <hr style="border:none;border-top:1px solid var(--border);margin:18px 0;">
                    <div style="display:flex;align-items:flex-start;gap:18px 32px;flex-wrap:wrap;">
                        <img src="https://www.khanacademy.org/favicon.ico" alt="Khan Academy" style="width:38px;height:38px;margin-right:12px;vertical-align:middle;">
                        <div style="flex:1 1 320px;min-width:220px;">
                            <b style="font-size:1.18em;color:var(--accent);">Khan Academy – Finance & Economics</b> — Free, world-class video lessons on everything from money basics to advanced investing and macroeconomics. <a href="https://www.khanacademy.org/economics-finance-domain/core-finance" target="_blank" style="color:var(--accent);font-weight:600;">Learn More</a>
                        </div>
                    </div>
                    <hr style="border:none;border-top:1px solid var(--border);margin:18px 0;">
                    <div style="display:flex;align-items:flex-start;gap:18px 32px;flex-wrap:wrap;">
                        <img src="https://www.cfainstitute.org/favicon.ico" alt="CFA Institute" style="width:38px;height:38px;margin-right:12px;vertical-align:middle;">
                        <div style="flex:1 1 320px;min-width:220px;">
                            <b style="font-size:1.18em;color:var(--accent);">CFA Institute</b> — The global gold standard for investment professionals, offering the CFA® Program, research, and in-depth reports on AI, climate finance, and global markets. <a href="https://www.cfainstitute.org/" target="_blank" style="color:var(--accent);font-weight:600;">Learn More</a>
                        </div>
                    </div>
                    <hr style="border:none;border-top:1px solid var(--border);margin:18px 0;">
                    <div style="display:flex;align-items:flex-start;gap:18px 32px;flex-wrap:wrap;">
                        <img src="https://www.morningstar.com/favicon.ico" alt="Morningstar" style="width:38px;height:38px;margin-right:12px;vertical-align:middle;">
                        <div style="flex:1 1 320px;min-width:220px;">
                            <b style="font-size:1.18em;color:var(--accent);">Morningstar</b> — Independent investment research, mutual fund and ETF ratings, portfolio tools, and up-to-date market news. <a href="https://www.morningstar.com/" target="_blank" style="color:var(--accent);font-weight:600;">Learn More</a>
                        </div>
                    </div>
                    <hr style="border:none;border-top:1px solid var(--border);margin:18px 0;">
                    <div style="display:flex;align-items:flex-start;gap:18px 32px;flex-wrap:wrap;">
                        <img src="https://www.nasdaq.com/favicon.ico" alt="Nasdaq" style="width:38px;height:38px;margin-right:12px;vertical-align:middle;">
                        <div style="flex:1 1 320px;min-width:220px;">
                            <b style="font-size:1.18em;color:var(--accent);">Nasdaq</b> — Real-time market data, IPO news, and educational content on trading, ETFs, and global capital markets. <a href="https://www.nasdaq.com/" target="_blank" style="color:var(--accent);font-weight:600;">Learn More</a>
                        </div>
                    </div>
                    <!-- ...existing code replaced with unified, robust, mobile-first, and feature-rich HTML/CSS/JS from goals_page.html, preserving all unique logic and features from both files, and making the result longer and better... -->
            {name:'p', label:'P (price per unit)', type:'number'},
            {name:'f', label:'F (fixed cost)', type:'number'},
            {name:'v', label:'V (variable cost)', type:'number'}
        ],
        dtl: [
            {name:'ebit', label:'EBIT', type:'number'},
            {name:'ebt', label:'EBT', type:'number'}
        ],
        dfl: [
            {name:'ebt', label:'EBT', type:'number'},
            {name:'ebtMinusInterest', label:'EBT - Interest', type:'number'}
        ],
        eva: [
            {name:'nopat', label:'NOPAT', type:'number'},
            {name:'capital', label:'Capital', type:'number'},
            {name:'wacc', label:'WACC', type:'number'}
        ],
        portfoliorisk: [
            {name:'weights', label:'Weights (comma, e.g. 0.5,0.5)', type:'text'},
            {name:'covariances', label:'Covariances (semicolon rows, comma cols, e.g. 0.04,0.01;0.01,0.09)', type:'text'}
        ]
    };
    const formulaHelp = {
        eps: 'EPS = Net Income / Shares',
        dps: 'DPS = Dividends / Shares',
        wacc: 'WACC = Ke*We + Kd*Wd*(1-T) + Kp*Wp',
        wmcc: 'WMCC = Σ(Cost × Weight)',
        ytm: 'YTM = (Coupon + (Face-Price)/n) / ((Face+Price)/2)',
        vat: 'VAT = Amount × Rate (%)',
        pe: 'P/E = Price / EPS',
        intrinsic: 'Intrinsic Value = Dividend / (Rate - Growth)',
        ke: 'Ke = (Dividend/Price) + Growth',
        kd: 'Kd = Interest / Price',
        kp: 'Kp = Dividend / Price',
        npv: 'NPV = Σ(Cashflow / (1+Rate)^t)',
        irr: 'IRR = Internal Rate of Return (solves NPV=0)',
        pi: 'PI = (NPV + Investment) / Investment',
        cashflows: 'Cashflows = Inflows - Outflows',
        correlation: 'Correlation Coefficient = relationship between two datasets',
        cumright: 'Cum Right = Shares + Rights',
        exdiv: 'Ex Dividend = Price - Dividend',
        dol: 'DOL = Q(P-F) / [Q(P-F)-V]',
        dtl: 'DTL = EBIT / EBT',
        dfl: 'DFL = EBT / (EBT - Interest)',
        eva: 'EVA = NOPAT - Capital × WACC',
        portfoliorisk: 'Portfolio Risk = sqrt(ΣΣ(Weight_i × Weight_j × Cov_ij))'
    };
    function renderFormulaInputs(formula) {
        const inputs = formulaInputs[formula] || [];
        if (!inputs.length) return `<div style='color:#e53935;font-weight:600;'>No input fields found for this formula.</div>`;
        // Use grid for 3+ fields, vertical stack for 1-2
        let html = '';
        if (inputs.length <= 2) {
            for(const inp of inputs) {
                html += `<div style='display:flex;flex-direction:column;gap:2px;margin-bottom:12px;'>
                    <label for='${inp.name}' style='font-weight:600;margin-bottom:2px;'>${inp.label}</label>
                    <input type='${inp.type}' name='${inp.name}' id='${inp.name}' style='width:100%;padding:7px 8px;border-radius:5px;border:1px solid var(--border);background:var(--bg);font-size:1.05em;' required autocomplete='off' ${inp.type==='number'?'step="any"':''}>
                    ${inp.help?`<span style='color:var(--muted);font-size:0.97em;margin-top:1px;'>${inp.help}</span>`:''}
                </div>`;
            }
        } else {
            html += `<div style='display:grid;grid-template-columns:1fr 1fr;gap:18px 32px;'>`;
            for(const inp of inputs) {
                html += `<div style='display:flex;flex-direction:column;gap:2px;'>
                    <label for='${inp.name}' style='font-weight:600;margin-bottom:2px;'>${inp.label}</label>
                    <input type='${inp.type}' name='${inp.name}' id='${inp.name}' style='width:100%;padding:7px 8px;border-radius:5px;border:1px solid var(--border);background:var(--bg);font-size:1.05em;' required autocomplete='off' ${inp.type==='number'?'step="any"':''}>
                    ${inp.help?`<span style='color:var(--muted);font-size:0.97em;margin-top:1px;'>${inp.help}</span>`:''}
                </div>`;
            }
            html += `</div>`;
        }
        return html;
    }
    (function() {
        function ready(fn) {
            if (document.readyState !== 'loading') fn();
            else document.addEventListener('DOMContentLoaded', fn);
        }
        ready(function() {
            const formulaSelect = document.getElementById('formula-select');
            const formulaInputsDiv = document.getElementById('formula-inputs');
            const formulaSummaryDiv = document.getElementById('formula-summary');
            const financeForm = document.getElementById('finance-form');
            // Show relevant input fields and summary as soon as a formula is selected
            function updateFormulaInputs() {
                formulaInputsDiv.innerHTML = renderFormulaInputs(formulaSelect.value);
                formulaSummaryDiv.innerHTML = formulaHelp[formulaSelect.value] ? `<b>Formula:</b> ${formulaHelp[formulaSelect.value]}` : '';
                document.getElementById('finance-results').innerHTML = '<span style="color:var(--muted);">Enter values and click Calculate.</span>';
            }
            formulaSelect.addEventListener('change', updateFormulaInputs);
            updateFormulaInputs();
            financeForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const formula = formulaSelect.value;
                const data = Object.fromEntries(new FormData(this).entries());
                function num(x) { return Number(x) || 0; }
                function arr(x) { return (x||'').split(',').map(Number).filter(v=>!isNaN(v)); }
                function arr2(x) { return (x||'').split(';').map(row=>row.split(',').map(Number)); }
                let result = '';
                try {
                    if(formula==='eps') result = `<b>EPS</b>: ${num(data.netIncome)} / ${num(data.shares)} = <b>${(num(data.netIncome)/num(data.shares)).toFixed(4)}</b>`;
                    else if(formula==='dps') result = `<b>DPS</b>: ${num(data.dividends)} / ${num(data.shares)} = <b>${(num(data.dividends)/num(data.shares)).toFixed(4)}</b>`;
                    else if(formula==='wacc') result = `<b>WACC</b>: ${num(data.ke)}*${num(data.we)} + ${num(data.kd)}*${num(data.wd)}*(1-${num(data.t)}) + ${num(data.kp)}*${num(data.wp)} = <b>${(num(data.ke)*num(data.we) + num(data.kd)*num(data.wd)*(1-num(data.t)) + num(data.kp)*num(data.wp)).toFixed(4)}</b>`;
                    else if(formula==='wmcc') {
                        let costs = [num(data.ke), num(data.kd), num(data.kp)];
                        let weights = arr(data.weights);
                        if(weights.length===costs.length)
                            result = `<b>WMCC</b>: Σ(Cost × Weight) = <b>${costs.map((c,i)=>`${c}×${weights[i]}`).join(' + ')} = ${(costs.reduce((s,c,i)=>s+c*weights[i],0)).toFixed(4)}</b>`;
                        else result = 'Please provide weights for each cost.';
                    }
                    else if(formula==='ytm') result = `<b>YTM</b>: (${num(data.coupon)} + (${num(data.face)}-${num(data.price)})/${num(data.n)}) / ((${num(data.face)}+${num(data.price)})/2) = <b>${((num(data.coupon)+(num(data.face)-num(data.price))/num(data.n))/((num(data.face)+num(data.price))/2)).toFixed(4)}</b>`;
                    else if(formula==='vat') result = `<b>VAT</b>: ${num(data.amount)} × ${num(data.rate)}% = <b>${(num(data.amount)*num(data.rate)/100).toFixed(4)}</b>`;
                    else if(formula==='pe') result = `<b>P/E</b>: ${num(data.price)} / ${num(data.eps)} = <b>${(num(data.price)/num(data.eps)).toFixed(4)}</b>`;
                    else if(formula==='intrinsic') result = `<b>Intrinsic Value</b>: ${num(data.dividend)} / (${num(data.rate)} - ${num(data.growth)}) = <b>${(num(data.dividend)/(num(data.rate)-num(data.growth))).toFixed(4)}</b>`;
                    else if(formula==='ke') result = `<b>Ke</b>: (${num(data.dividend)}/${num(data.price)}) + ${num(data.growth)} = <b>${((num(data.dividend)/num(data.price))+num(data.growth)).toFixed(4)}</b>`;
                    else if(formula==='kd') result = `<b>Kd</b>: ${num(data.interest)} / ${num(data.price)} = <b>${(num(data.interest)/num(data.price)).toFixed(4)}</b>`;
                    else if(formula==='kp') result = `<b>Kp</b>: ${num(data.dividend)} / ${num(data.price)} = <b>${(num(data.dividend)/num(data.price)).toFixed(4)}</b>`;
                    else if(formula==='npv') {
                        let cfs = arr(data.cashflows);
                        let r = num(data.rate)/100;
                        let npv = cfs.reduce((sum, cf, i) => sum + cf/Math.pow(1+r, i+1), 0);
                        result = `<b>NPV</b>: Σ(Cashflow/(1+${r})^t) = <b>${npv.toFixed(4)}</b>`;
                    }
                    else if(formula==='irr') {
                        let cfs = arr(data.cashflows);
                        let irr = (function irr(cashflows, guess=0.1) {
                            let rate = guess;
                            for(let iter=0; iter<100; iter++) {
                                let npv = 0, dnpv = 0;
                                for(let t=0; t<cashflows.length; t++) {
                                    npv += cashflows[t]/Math.pow(1+rate, t+1);
                                    dnpv -= (t+1)*cashflows[t]/Math.pow(1+rate, t+2);
                                }
                                let newRate = rate - npv/dnpv;
                                if(Math.abs(newRate-rate)<1e-6) return newRate;
                                rate = newRate;
                            }
                            return rate;
                        })(cfs);
                        result = `<b>IRR</b>: <b>${(irr*100).toFixed(2)}%</b>`;
                    }
                    else if(formula==='pi') result = `<b>PI</b>: (${num(data.npv)} + ${num(data.investment)}) / ${num(data.investment)} = <b>${((num(data.npv)+num(data.investment))/num(data.investment)).toFixed(4)}</b>`;
                    else if(formula==='cashflows') {
                        let inflows = arr(data.inflows), outflows = arr(data.outflows);
                        let cashflows = inflows.map((v,i)=>v-(outflows[i]||0));
                        result = `<b>Cashflows</b>: Inflows - Outflows = [${cashflows.join(', ')}]`;
                    }
                    else if(formula==='correlation') {
                        let x = arr(data.x), y = arr(data.y);
                        if(x.length===y.length && x.length>1) {
                            const n = x.length;
                            const avgX = x.reduce((a,b)=>a+b,0)/n;
                            const avgY = y.reduce((a,b)=>a+b,0)/n;
                            let nume=0, denX=0, denY=0;
                            for(let i=0;i<n;i++){
                                nume+=(x[i]-avgX)*(y[i]-avgY);
                                denX+=(x[i]-avgX)**2; denY+=(y[i]-avgY)**2;
                            }
                            let corr = nume/Math.sqrt(denX*denY);
                            result = `<b>Correlation Coefficient</b>: <b>${corr.toFixed(4)}</b>`;
                        } else result = 'Please provide equal-length X and Y arrays.';
                    }
                    else if(formula==='cumright') result = `<b>Cum Right</b>: ${num(data.shares)} + ${num(data.rights)} = <b>${(num(data.shares)+num(data.rights)).toFixed(4)}</b>`;
                    else if(formula==='exdiv') result = `<b>Ex Dividend</b>: ${num(data.price)} - ${num(data.dividend)} = <b>${(num(data.price)-num(data.dividend)).toFixed(4)}</b>`;
                    else if(formula==='dol') result = `<b>DOL</b>: ${num(data.q)}*(${num(data.p)}-${num(data.f)}) / [${num(data.q)}*(${num(data.p)}-${num(data.f)})-${num(data.v)}] = <b>${((num(data.q)*(num(data.p)-num(data.f)))/(num(data.q)*(num(data.p)-num(data.f))-num(data.v))).toFixed(4)}</b>`;
                    else if(formula==='dtl') result = `<b>DTL</b>: ${num(data.ebit)} / ${num(data.ebt)} = <b>${(num(data.ebit)/num(data.ebt)).toFixed(4)}</b>`;
                    else if(formula==='dfl') result = `<b>DFL</b>: ${num(data.ebt)} / ${num(data.ebtMinusInterest)} = <b>${(num(data.ebt)/num(data.ebtMinusInterest)).toFixed(4)}</b>`;
                    else if(formula==='eva') result = `<b>EVA</b>: ${num(data.nopat)} - ${num(data.capital)}×${num(data.wacc)} = <b>${(num(data.nopat)-num(data.capital)*num(data.wacc)).toFixed(4)}</b>`;
                    else if(formula==='portfoliorisk') {
                        let weights = arr(data.weights);
                        let covs = arr2(data.covariances);
                        let risk = 0;
                        for(let i=0;i<weights.length;i++){
                            for(let j=0;j<weights.length;j++){
                                risk += weights[i]*weights[j]*(covs[i]&&covs[i][j]?covs[i][j]:0);
                            }
                        }
                        result = `<b>Portfolio Risk</b>: sqrt(${risk.toFixed(4)}) = <b>${Math.sqrt(risk).toFixed(4)}</b>`;
                    }
                } catch(err) {
                    result = 'Error in calculation: '+err.message;
                }
                document.getElementById('finance-results').innerHTML = result || '<span style="color:var(--muted);">Please fill in values and submit to see result.</span>';
            });
        });
    })();
        // --- Infinite Background Color Animation ---
        let hue = 200;
        function animateBg() {
            hue = (hue + 0.2) % 360;
            document.body.style.background = `linear-gradient(120deg, hsl(${hue},80%,16%) 0%, hsl(${(hue+60)%360},100%,22%) 100%)`;
            requestAnimationFrame(animateBg);
        }
        animateBg();
        // --- Sidebar Dynamic Content ---
    // (Removed old/duplicate sidebar data arrays and functions to avoid conflicts)
        // Right Sidebar
        const liveQuotes = [
            {name:'USD/KES', value:'146.20'},
            {name:'EUR/USD', value:'1.11'},
            {name:'AAPL', value:'$195.30'},
            {name:'TSLA', value:'$720.10'},
            {name:'BTC/USD', value:'$67,200'}
        ];
        function renderLiveQuotes() {
            let html = '<ul style="list-style:none;padding:0;margin:0;">';
            for(const q of liveQuotes) html += `<li><b>${q.name}:</b> ${q.value}</li>`;
            html += '</ul>';
            document.getElementById('live-quotes').innerHTML = html;
        }
        renderLiveQuotes();
        const events = [
            {date:'Aug 20', event:'AI in Finance Webinar'},
            {date:'Aug 25', event:'Student Fund Pitch Day'},
            {date:'Sep 2', event:'Global Markets Conference'},
            {date:'Sep 10', event:'Research Paper Submission Deadline'}
        ];
        let eventIdx = 0;
        function updateEvents() {
            let html = '';
            for(let i=0;i<2;i++) {
                const e = events[(eventIdx+i)%events.length];
                html += `<li><b>${e.date}:</b> ${e.event}</li>`;
            }
            eventIdx = (eventIdx+1)%events.length;
            document.getElementById('upcoming-events').innerHTML = html;
        }
        setInterval(updateEvents, 5000); updateEvents();
        const research = [
            'Whitepaper: Neural Networks in Portfolio Management',
            'Case Study: Student Funds Driving Innovation',
            'Report: AI Regulation in Global Markets',
            'Insight: The Future of Decentralized Finance'
        ];
        let researchIdx = 0;
        function updateResearch() {
            document.getElementById('featured-research').textContent = research[researchIdx];
            researchIdx = (researchIdx+1)%research.length;
        }
        setInterval(updateResearch, 7000); updateResearch();
        const highlights = [
            '“Strathmore students win global AI challenge.”',
            '“Our fund featured in Financial Times.”',
            '“New partnership with Nasdaq announced.”',
            '“Faculty publishes in top AI journal.”'
        ];
        let hlIdx = 0;
        function updateHighlights() {
            document.getElementById('community-highlights').textContent = highlights[hlIdx];
            hlIdx = (hlIdx+1)%highlights.length;
        }
        setInterval(updateHighlights, 6000); updateHighlights();
        // --- Resource Rotator (auto only, every 3 seconds) ---
        const resources = [
            {
                url: "https://www.wsj.com/",
                title: "Wall Street Journal: Markets",
                quote: "Stay updated with the latest global finance news, market trends, and analysis from the WSJ."
            },
            {
                url: "https://www.nasdaq.com/market-activity",
                title: "Nasdaq: Market Activity",
                quote: "Track real-time market activity, indices, and trading data from Nasdaq."
            },
            {
                url: "https://www.nasdaq.com/solutions",
                title: "Nasdaq: Solutions",
                quote: "Discover modern market solutions and technology for global capital markets."
            },
            {
                url: "https://www.blackrock.com/fund-regulatory",
                title: "BlackRock: Fund Regulation",
                quote: "Transparency and compliance are key to modern fund management. BlackRock provides regulatory resources and updates."
            },
            {
                url: "https://www.ft.com/markets",
                title: "Financial Times: Markets",
                quote: "Global market news, analysis, and data from the Financial Times."
            },
            {
                url: "https://www.investopedia.com/",
                title: "Investopedia: Financial Education",
                quote: "Comprehensive financial education, investing guides, and market analysis."
            },
            {
                url: "https://www.bloomberg.com/markets",
                title: "Bloomberg Markets",
                quote: "Business, markets, and data news from Bloomberg."
            }
        ];
        let resourceIdx = 0;
        function renderResource() {
            const r = resources[resourceIdx];
            document.getElementById('resource-content').innerHTML = `
                <a href='${r.url}' target='_blank' style='display:inline-block;padding:16px 18px;background:rgba(88,166,255,0.12);border-radius:8px;font-weight:700;color:var(--accent);text-decoration:none;font-size:1.08em;margin-bottom:8px;'>${r.title}</a>
                <div style='margin-top:10px;font-size:1.02em;color:var(--muted);font-style:italic;'>${r.quote}</div>
            `;
        }
        setInterval(() => {
            resourceIdx = (resourceIdx + 1) % resources.length;
            renderResource();
        }, 3000);
        renderResource();
        // --- Financial History Timeline ---
        const financeHistory = [
            {date:'1694', event:'Bank of England founded, pioneering the modern central bank and stabilizing government debt and currency.'},
            {date:'1720', event:'South Sea Bubble and Mississippi Bubble burst, teaching the first global lessons about financial speculation and regulation.'},
            {date:'Late 1700s', event:'Joint-stock companies and insurance markets like Lloyd’s of London enable global trade and risk management.'},
            {date:'1817', event:'New York Stock Exchange is formally established, marking the rise of organized equity trading.'},
            {date:'1855', event:'Limited liability laws in the UK encourage entrepreneurship and risk-taking, fueling industrial growth.'},
            {date:'1863-64', event:'U.S. National Banking Acts create a uniform currency and national banking system, but also instability.'},
            {date:'1873–1879', event:'The Long Depression begins with the Vienna Stock Exchange collapse, spreading global financial turmoil.'},
            {date:'Late 1800s', event:'London becomes the world’s financial capital; telegraph and steamship technology enable rapid global capital movement.'},
            {date:'1907', event:'Panic of 1907 leads to the creation of the U.S. Federal Reserve in 1913.'},
            {date:'1929', event:'Wall Street Crash triggers the Great Depression, prompting sweeping global financial reforms.'},
            {date:'1944', event:'Bretton Woods Conference establishes the IMF and World Bank, anchoring the postwar financial system.'},
            {date:'1971', event:'End of the gold standard; currencies begin to float, ushering in a new era of global finance.'},
            {date:'1987', event:'Black Monday: Largest single-day stock market drop in history highlights risks of globalized markets.'},
            {date:'2008', event:'Global Financial Crisis exposes the dangers of leverage and interconnected markets, leading to new regulation.'},
            {date:'2020s', event:'Digital finance, fintech, and central bank digital currencies (CBDCs) reshape how money moves and how people invest.'}
        ];
        function renderFinanceHistory() {
            let html = '';
            for(const h of financeHistory) {
                html += `<li><b>${h.date}:</b> ${h.event}</li>`;
            }
            document.getElementById('finance-history').innerHTML = html;
        }
        renderFinanceHistory();
        // --- Financial Calculator AI Chatbox (Refined) ---
        const financialFormulas = {
            eps: (netIncome, shares) => netIncome / shares,
            dps: (dividends, shares) => dividends / shares,
            wacc: (ke, we, kd, wd, kp, wp, t) => (ke*we + kd*wd*(1-t) + kp*wp),
            wmcc: (costs, weights) => costs.reduce((sum, c, i) => sum + c*weights[i], 0),
            ytm: (face, price, coupon, n) => ((coupon + (face-price)/n) / ((face+price)/2)),
            vat: (amount, rate) => amount * rate / 100,
            pe: (price, eps) => price / eps,
            intrinsic: (dividend, growth, rate) => dividend / (rate - growth),
            ke: (dividend, price, growth) => (dividend/price) + growth,
            kd: (interest, price) => interest / price,
            kp: (dividend, price) => dividend / price,
            npv: (cashflows, rate) => cashflows.reduce((sum, cf, i) => sum + cf/Math.pow(1+rate, i+1), 0),
            irr: (cashflows, guess=0.1) => { // Newton-Raphson
                let rate = guess;
                for(let iter=0; iter<100; iter++) {
                    let npv = 0, dnpv = 0;
                    for(let t=0; t<cashflows.length; t++) {
                        npv += cashflows[t]/Math.pow(1+rate, t+1);
                        dnpv -= (t+1)*cashflows[t]/Math.pow(1+rate, t+2);
                    }
                    let newRate = rate - npv/dnpv;
                    if(Math.abs(newRate-rate)<1e-6) return newRate;
                    rate = newRate;
                }
                return rate;
            },
            pi: (npv, investment) => (npv + investment) / investment,
            cashflows: (inflows, outflows) => inflows.map((v,i)=>v-(outflows[i]||0)),
            correlation: (x, y) => {
                const n = x.length;
                const avgX = x.reduce((a,b)=>a+b,0)/n;
                const avgY = y.reduce((a,b)=>a+b,0)/n;
                let num=0, denX=0, denY=0;
                for(let i=0;i<n;i++){
                    num+=(x[i]-avgX)*(y[i]-avgY);
                    denX+=(x[i]-avgX)**2; denY+=(y[i]-avgY)**2;
                }
                return num/Math.sqrt(denX*denY);
            },
            cumright: (shares, rights) => shares + rights,
            exdiv: (price, dividend) => price - dividend,
            dol: (q, p, f, v) => (q*(p-f))/(q*(p-f)-v),
            dtl: (ebit, ebt) => ebit/ebt,
            dfl: (ebt, ebtMinusInterest) => ebt/ebtMinusInterest,
            eva: (nopat, capital, wacc) => nopat - capital*wacc,
            portfolioRisk: (weights, variances, covariances) => {
                let risk = 0;
                for(let i=0;i<weights.length;i++){
                    for(let j=0;j<weights.length;j++){
                        risk += weights[i]*weights[j]*covariances[i][j];
                    }
                }
                return Math.sqrt(risk);
            }
        };
        const nseData = {
            'EABL': { price: 180, eps: 12.5, dps: 7.5, shares: 800000000 },
            'KCB': { price: 45, eps: 6.2, dps: 3.0, shares: 3000000000 },
            'SAFARICOM': { price: 22, eps: 1.8, dps: 1.2, shares: 40000000000 }
        };
        // --- Enhanced AI Chatbox Handler (Refined) ---
        chatForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const userMsg = chatInput.value.trim();
            if (!userMsg) return;
            chatMessages.innerHTML += `<div style='margin-bottom:6px;'><b>You:</b> ${userMsg}</div>`;
            chatInput.value = '';
            // Parse for formula keywords
            let response = '';
            try {
                const msg = userMsg.toLowerCase();
                // Financial calculations
                if(msg.includes('eps')) {
                    const match = /eps.*(\d+\.?\d*).*(\d+\.?\d*)/.exec(msg);
                    if(match) response = `EPS = Net Income / Shares = ${match[1]} / ${match[2]} = <b>${financialFormulas.eps(Number(match[1]), Number(match[2])).toFixed(2)}</b>`;
                    else response = 'Please provide net income and number of shares.';
                } else if(msg.includes('dps')) {
                    const match = /dps.*(\d+\.?\d*).*(\d+\.?\d*)/.exec(msg);
                    if(match) response = `DPS = Dividends / Shares = ${match[1]} / ${match[2]} = <b>${financialFormulas.dps(Number(match[1]), Number(match[2])).toFixed(2)}</b>`;
                    else response = 'Please provide total dividends and number of shares.';
                } else if(msg.includes('pe') || msg.includes('p/e')) {
                    const match = /pe.*(\d+\.?\d*).*(\d+\.?\d*)/.exec(msg);
                    if(match) response = `P/E = Price / EPS = ${match[1]} / ${match[2]} = <b>${financialFormulas.pe(Number(match[1]), Number(match[2])).toFixed(2)}</b>`;
                    else response = 'Please provide price and EPS.';
                } else if(msg.includes('npv')) {
                    const match = /npv.*\[(.*?)\].*rate.*(\d+\.?\d*)/i.exec(msg);
                    if(match) {
                        const cashflows = match[1].split(',').map(Number);
                        const rate = Number(match[2])/100;
                        response = `NPV = <b>${financialFormulas.npv(cashflows, rate).toFixed(2)}</b>`;
                    } else response = 'Please provide cashflows as [1000,900,800] and rate as a percent.';
                } else if(msg.includes('irr')) {
                    const match = /irr.*\[(.*?)\]/i.exec(msg);
                    if(match) {
                        const cashflows = match[1].split(',').map(Number);
                        response = `IRR = <b>${(financialFormulas.irr(cashflows)*100).toFixed(2)}%</b>`;
                    } else response = 'Please provide cashflows as [1000,900,800].';
                } else if(msg.includes('wacc')) {
                    response = 'WACC = Ke*We + Kd*Wd*(1-T) + Kp*Wp. Please provide values for Ke, We, Kd, Wd, Kp, Wp, and T.';
                } else if(msg.includes('nse')) {
                    const match = /nse.*(eabl|kcb|safaricom)/i.exec(msg);
                    if(match) {
                        const d = nseData[match[1].toUpperCase()];
                        response = `${match[1].toUpperCase()} - Price: ${d.price}, EPS: ${d.eps}, DPS: ${d.dps}, Shares: ${d.shares}`;
                    } else response = 'Please specify a valid NSE ticker (EABL, KCB, SAFARICOM).';
                } else if(msg.includes('hello') || msg.includes('hi')) {
                    response = 'Hello! I can help you with financial calculations, NSE data, or general finance questions.';
                } else if(msg.includes('thank')) {
                    response = 'You’re welcome! Let me know if you need more calculations or info.';
                } else if(msg.includes('who are you')) {
                    response = 'I am your financial assistant. I can compute finance formulas, explain concepts, and fetch NSE data.';
                } else {
                    response = 'I can help with financial calculations (EPS, DPS, P/E, NPV, IRR, WACC, etc.), NSE data, and general finance questions. Try: "Calculate EPS with net income 100000 and shares 5000" or "Show NSE SAFARICOM".';
                }
            } catch(err) {
                response = 'Sorry, I could not process your request.';
            }
            chatMessages.innerHTML += `<div style='margin-bottom:8px;'><b>AI:</b> ${response}</div>`;
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });
    </script>
</body>
</html>
